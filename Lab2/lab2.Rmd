---
title: "lab 2"
author: "Eric BÃ¶rjesson, Ludvig Ekman, Wenli Zhang, Tim Grube"
date: "17/11/2020"
output:
  pdf_document: default
  html_document: default
---


```{r setup, include=FALSE}
library(tidyverse) 
library(car) 
library(knitr)
library(psych)
library(pwr)
library(stargazer)
```

## Time
### Question a.

*Long text*


```{r 1a-vector}
data <- read.csv("./gotaflix-abn.csv")

pwr::pwr.anova.test(k=5, n=80, f = 0.0621, sig.level = 0.05)

```

### Question b.

```{r 1b}
data <- read.csv("./gotaflix-abn.csv")

data$Cover <- as.factor(data$Cover)
data$Engagement <- as.numeric(data$Engagement) 

aggregate(Engagement~Cover, data, mean) #Cover(grouping),calculating the value of Engagement in one group
aggregate(Engagement~Cover, data, median)
aggregate(Engagement~Cover, data, var)
aggregate(Engagement~Cover, data, sd) 

psych::describeBy(data, group = data$Cover) 
```

### Question c.

```{r c}
lindata <- lm(Engagement ~ Cover, data)
```
The intercept is the average engagement for the original cover. 

What is the value the model gives when only the coefficient for Cover C equals to 1
and the rest of the coefficients equals to 0?
Intercept + CoverC 
0.16 + 0.017..


### Question d.
What needs to be normal? 
Residuals

Does the S-W test agree with the qqplot? 
Both the qq-plot and the s-w test indicates that the residuals are normal. 
```{r d}

qqPlot(lindata)
plot(lindata)
shapiro.test(data$Engagement) 

```

### Question e.

The Levene test does not reject the null hyphosethis, so it is homoscedastic. 

```{r e}

plot(lindata)
leveneTest(lindata)

```

### Question f.
It is part of the design of the experiment, and should be verified by looking of that design. 

### Question g.
The levine test with the data in the modified file rejects homoscedasticity. 
```{r g}
data2 <- read.csv("./gotaflix-abn-modified.csv")

data2$Cover <- as.factor(data2$Cover)
data2$Engagement <- as.numeric(data2$Engagement) 

lindata2 <- lm(Engagement ~ Cover, data2)

leveneTest(lindata2)

aggregate(Engagement~Cover, data2, mean) #Cover(grouping),calculating the value of Engagement in one group
aggregate(Engagement~Cover, data2, median)
aggregate(Engagement~Cover, data2, var)
aggregate(Engagement~Cover, data2, sd) 

psych::describeBy(data2, group = data2$Cover) 
```

### Question h. 

``` {r h}
summary(lindata)
```












## Full factorial experiment
### Question a.
*How many and what are the experimental groups?*  
There are 2 different factors and each factor has 2 levels, so there are total of 4 experimental groups. The groups are:

1. Cover = Character & Summary = Character
2. Cover = Character & Summary = Genre
3. Cover = Genre & Summary = Character
4. Cover = Genre & Summary = Genre

### Question b.
*The design of this experiment can be seen as a two-way ANOVA. Load the data (gotaflix-2wayANOVA.csv) and fit a linear model. Write the equation of this linear model. What does it mean the intercept value?*  
The intercept is the models estimation of the engagement value when the two factors Cover and Summary are set to 0. In this case, that is when *Cover = Character & Summary = Character*. 
We have created 3 linear models below: lm.1, lm.2 and lm.3. The model lm.1 uses the two independent variables *Cover & Summary* to predict the dependent variable Engagement. The models lm.2 and lm.3 also includes the interaction between the factors and are modeled in two different ways. An inspection of the results below show that they produce equivalent outcome. 
```{r twoWayAnova}
twoWayAnova <- read.csv("~/Downloads/Lab2/gotaflix-2wayANOVA.csv", stringsAsFactors = TRUE)
lm1 <- lm(Engagement ~ Cover + Summary, data = twoWayAnova)
lm2 <- lm(Engagement ~ Cover + Summary + Cover:Summary, data = twoWayAnova)
lm3 <- lm(Engagement ~ Cover*Summary, data = twoWayAnova)
summary(lm1) # alpha = 0.169028
summary(lm2) # alpha = 0.175266
summary(lm3) # alpha = 0.175266
```
### Question c.
*Analyze the assumptions of this two-way ANOVA. Independence, normality and homoscedasticity*  
**Independence** - The assumption of independence means that there should not exist any relationship between the observations within and between the groups. This is related to the design of the study and is not something we can verify from the given data set. However from the provided description, 50 movies have been randomly selected and users have been randomly assigned to the experimental groups. This would conform with the assumption of independence since both the movies and users are randomly picked. However, the movies have been randomly selected among the top 200 movies and is thereby not a random sample of the population. This could effectively influence the outcome and the result might not be possible to generalize for the entire population, that is all the movies.  

**Normality** - Below is a histogram of the residuals. A visual inspection of the histogram indicates that the residuals are normally distributed and thus the normality assumption is met.
```{r twoWayAnova-normality}
# Normality of residuals - looks good
hist(lm3$residuals, main = "Histogram", xlab = "Residuals")
```
**Homoscedasticity** - We have used the Levene's test to check for homoscedasticity, that is to verify that the variances are equal. The null hypothesis is that the population variances are equal. The Levene's test below shows that the null hypothesis can be rejected since the p-value is very low and lower than a significance value of 0.05. Thus, there is no statistical significant evidence that the variances are equal between the experimental groups.
```{r twoWayAnova-homoscedasticity}
leveneTest(lm3)
```
### Question d.
*Present the ANOVA table. What is statistically significant? What are the effect sizes? What conclusion can you make about this experiment?*
```{r twoWayAnova-analysis, results='asis'}
lm3.anova <- anova(lm3)
lm3.anova
stargazer::stargazer(lm3.anova, header = F)
```
By analyzing the above results using the p-value, we can conclude which independent variables are statistically significant. Below is a summary of each independent variable including the interaction effect, using a significance level of 0.05.  

- Cover: p-value = 0.030075 < 0.05. It is significant.
- Summary: p-value = 0.133952 > 005. It is not significant.
- Interaction between Cover and Summary: p-value = 0.002141 < 0.05. It is significant.


**Effect Size** - The effect size, r-squared, can be calculated using:  

* SS(A) / SS(T)  
* SS(A) = factor A sum of squares  
* SS(T) = total sum of squares   

We have only calculated the effect size of the factors that were statistically significant, which was Cover and the interaction between Cover and Summary.
if we have huge data sets it's easy to find statistical significance (that's how the model works) but looking at the size of the effect tells us if this factor is relevant at all.
```{r}
TSS <- sum(lm3.anova$`Sum Sq`)
SScover <- 0.062
SScoverSummary <- 0.125
r2cover <- SScover / TSS
r2coverSummary <- SScoverSummary / TSS
c(r2cover, r2coverSummary)
```
**Conclusion** - Cover and the interaction between Cover and Summary are statistically significant which means that they impact the output value for Engagement. However, the effect size is very low for both Cover (0.15%) and the interaction (0.30%). This indicates that both factors have little to no effect on the engagement level and that other variables not included in the model influence the engagement level. This could also be seen above in the ANOVA table where the sum of squares for the residuals is much higher than both factors.

## Contributions

All four of us attended the lab. During the lab we went through all questions, discussed them and wrote down our first thoughts. There were a few aspects that we could not solve immediately and needed to do more detailed research about it, for example task 1g and 2d. Therefore, we decided do split up the group. Wenli and Tim concentrated on the first task and Ludvig and Eric on the second task. In these smaller groups we had a closer look at the subtasks again, improved the work from the lab and added the missing information. After that we collected everything in one document and everyone of the group checked it again, so that everybody knows about all final results.

